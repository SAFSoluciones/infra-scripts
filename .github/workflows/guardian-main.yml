name: Guardian de Main
on:
  pull_request:

jobs:
  verificar-permisos:
    runs-on: ubuntu-latest
    steps:
      - name: Validar usuario
        uses: actions/github-script@v6
        with:
          script: |
            // --- CONFIGURACI√ìN ---
            // Pon aqu√≠ los usuarios que S√ç pueden pasar a main.
            // (He puesto tu usuario 'psaf-5' para que t√∫ s√≠ puedas,
            // pero si quieres probar el bloqueo, qu√≠talo de la lista un momento).
            const allowedUsers = ['psaf-5', 'OtroAdmin']; 
            
            const actor = context.actor;
            console.log("Usuario actual: " + actor);

            // --- VALIDACI√ìN ---
            if (!allowedUsers.includes(actor)) {
              
              // 1. Dejar comentario de aviso
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                body: "üõë **ACCI√ìN BLOQUEADA** üõë\n\nHola @" + actor + ", est√°s intentando ir directo a **MAIN**.\n\n‚úã No tienes permisos para esta acci√≥n.\nüëâ Por favor cambia la rama destino hacia **DEVELOPER**."
              });

              // 2. Bloquear el bot√≥n de Merge (Rojo)
              core.setFailed(`Usuario ${actor} no autorizado.`);
            } else {
              console.log("‚úÖ Usuario autorizado.");
            }
